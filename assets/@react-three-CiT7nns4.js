import{r as m,j as G}from"./react-CTCOLnsY.js";import{R as Bt,O as Ne,P as Ue,S as Nt,a as _e,V as Ut,b as Gt,B as Vt,N as qt,A as Xt,W as Yt,C as Zt,c as $,d as mt,e as Kt,L as Ce,f as Jt,U as Qt,T as en,D as tn,g as be,h as Ge,i as et,j as nn,E as ht,M as rn,k as on,l as sn,m as an,n as ce,o as cn,p as ln,q as un}from"./three-B3SFhjFH.js";import{j as fn}from"./react-use-measure-DU3eRiDS.js";import{F as dn,u as pn}from"./its-fine-D4TqyB-N.js";import{c as ae,R as mn}from"./react-reconciler-NyiMArlJ.js";import{s as tt}from"./scheduler-CylivXx-.js";import{_ as K}from"./@babel-CF3RwP-h.js";import{c as hn}from"./react-dom-DlSNA-cX.js";import{c as vn}from"./zustand-CKfsRyo9.js";import"./maath-Zm2ueaKa.js";import{D as gn,G as Ve,a as yn,M as Re,O as bn}from"./three-stdlib-SUSaznIQ.js";import{s as wn,p as xn,c as Sn}from"./suspend-react-BKIKQNXN.js";function En(e){let t;const n=new Set,o=(h,r)=>{const i=typeof h=="function"?h(t):h;if(i!==t){const p=t;t=r?i:Object.assign({},t,i),n.forEach(l=>l(t,p))}},a=()=>t,s=(h,r=a,i=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let p=r(t);function l(){const f=r(t);if(!i(p,f)){const x=p;h(p=f,x)}}return n.add(l),()=>n.delete(l)},c={setState:o,getState:a,subscribe:(h,r,i)=>r||i?s(h,r,i):(n.add(h),()=>n.delete(h)),destroy:()=>n.clear()};return t=e(o,a,c),c}const Mn=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),nt=Mn?m.useEffect:m.useLayoutEffect;function Pn(e){const t=typeof e=="function"?En(e):e,n=(o=t.getState,a=Object.is)=>{const[,s]=m.useReducer(b=>b+1,0),v=t.getState(),g=m.useRef(v),c=m.useRef(o),h=m.useRef(a),r=m.useRef(!1),i=m.useRef();i.current===void 0&&(i.current=o(v));let p,l=!1;(g.current!==v||c.current!==o||h.current!==a||r.current)&&(p=o(v),l=!a(i.current,p)),nt(()=>{l&&(i.current=p),g.current=v,c.current=o,h.current=a,r.current=!1});const f=m.useRef(v);nt(()=>{const b=()=>{try{const u=t.getState(),y=c.current(u);h.current(i.current,y)||(g.current=u,i.current=y,s())}catch{r.current=!0,s()}},d=t.subscribe(b);return t.getState()!==f.current&&b(),d},[]);const x=l?p:i.current;return m.useDebugValue(x),x};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const o=[n,t];return{next(){const a=o.length<=0;return{value:o.shift(),done:a}}}},n}const qe={},_n=e=>void Object.assign(qe,e);function Cn(e,t){function n(r,{args:i=[],attach:p,...l},f){let x=`${r[0].toUpperCase()}${r.slice(1)}`,b;if(r==="primitive"){if(l.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const d=l.object;b=ie(d,{type:r,root:f,attach:p,primitive:!0})}else{const d=qe[x];if(!d)throw new Error(`R3F: ${x} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(i))throw new Error("R3F: The args prop must be an array!");b=ie(new d(...i),{type:r,root:f,attach:p,memoizedProps:{args:i}})}return b.__r3f.attach===void 0&&(b.isBufferGeometry?b.__r3f.attach="geometry":b.isMaterial&&(b.__r3f.attach="material")),x!=="inject"&&Ae(b,l),b}function o(r,i){let p=!1;if(i){var l,f;(l=i.__r3f)!=null&&l.attach?je(r,i,i.__r3f.attach):i.isObject3D&&r.isObject3D&&(r.add(i),p=!0),p||(f=r.__r3f)==null||f.objects.push(i),i.__r3f||ie(i,{}),i.__r3f.parent=r,$e(i),se(i)}}function a(r,i,p){let l=!1;if(i){var f,x;if((f=i.__r3f)!=null&&f.attach)je(r,i,i.__r3f.attach);else if(i.isObject3D&&r.isObject3D){i.parent=r,i.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:i});const b=r.children.filter(u=>u!==i),d=b.indexOf(p);r.children=[...b.slice(0,d),i,...b.slice(d)],l=!0}l||(x=r.__r3f)==null||x.objects.push(i),i.__r3f||ie(i,{}),i.__r3f.parent=r,$e(i),se(i)}}function s(r,i,p=!1){r&&[...r].forEach(l=>v(i,l,p))}function v(r,i,p){if(i){var l,f,x;if(i.__r3f&&(i.__r3f.parent=null),(l=r.__r3f)!=null&&l.objects&&(r.__r3f.objects=r.__r3f.objects.filter(M=>M!==i)),(f=i.__r3f)!=null&&f.attach)at(r,i,i.__r3f.attach);else if(i.isObject3D&&r.isObject3D){var b;r.remove(i),(b=i.__r3f)!=null&&b.root&&kn(Ee(i),i)}const u=(x=i.__r3f)==null?void 0:x.primitive,y=!u&&(p===void 0?i.dispose!==null:p);if(!u){var d;s((d=i.__r3f)==null?void 0:d.objects,i,y),s(i.children,i,y)}if(delete i.__r3f,y&&i.dispose&&i.type!=="Scene"){const M=()=>{try{i.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?tt.unstable_scheduleCallback(tt.unstable_IdlePriority,M):M()}se(r)}}function g(r,i,p,l){var f;const x=(f=r.__r3f)==null?void 0:f.parent;if(!x)return;const b=n(i,p,r.__r3f.root);if(r.children){for(const d of r.children)d.__r3f&&o(b,d);r.children=r.children.filter(d=>!d.__r3f)}r.__r3f.objects.forEach(d=>o(b,d)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||v(x,r),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),o(x,b),b.raycast&&b.__r3f.eventCount&&Ee(b).getState().internal.interaction.push(b),[l,l.alternate].forEach(d=>{d!==null&&(d.stateNode=b,d.ref&&(typeof d.ref=="function"?d.ref(b):d.ref.current=b))})}const c=()=>{};return{reconciler:mn({createInstance:n,removeChild:v,appendChild:o,appendInitialChild:o,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,i)=>{if(!i)return;const p=r.getState().scene;p.__r3f&&(p.__r3f.root=r,o(p,i))},removeChildFromContainer:(r,i)=>{i&&v(r.getState().scene,i)},insertInContainerBefore:(r,i,p)=>{if(!i||!p)return;const l=r.getState().scene;l.__r3f&&a(l,i,p)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var i;return!!((i=r==null?void 0:r.__r3f)!=null?i:{}).handlers},prepareUpdate(r,i,p,l){var f;if(((f=r==null?void 0:r.__r3f)!=null?f:{}).primitive&&l.object&&l.object!==r)return[!0];{const{args:b=[],children:d,...u}=l,{args:y=[],children:M,...E}=p;if(!Array.isArray(b))throw new Error("R3F: the args prop must be an array!");if(b.some((C,O)=>C!==y[O]))return[!0];const S=St(r,u,E,!0);return S.changes.length?[!1,S]:null}},commitUpdate(r,[i,p],l,f,x,b){i?g(r,l,x,b):Ae(r,p)},commitMount(r,i,p,l){var f;const x=(f=r.__r3f)!=null?f:{};r.raycast&&x.handlers&&x.eventCount&&Ee(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>ie(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var i;const{attach:p,parent:l}=(i=r.__r3f)!=null?i:{};p&&l&&at(l,r,p),r.isObject3D&&(r.visible=!1),se(r)},unhideInstance(r,i){var p;const{attach:l,parent:f}=(p=r.__r3f)!=null?p:{};l&&f&&je(f,r,l),(r.isObject3D&&i.visible==null||i.visible)&&(r.visible=!0),se(r)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>t?t():ae.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var rt,ot;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,vt=()=>{var e;return(e=qe.ColorManagement)!=null?e:null},gt=e=>e&&e.isOrthographicCamera,Rn=e=>e&&e.hasOwnProperty("current"),he=typeof window<"u"&&((rt=window.document)!=null&&rt.createElement||((ot=window.navigator)==null?void 0:ot.product)==="ReactNative")?m.useLayoutEffect:m.useEffect;function yt(e){const t=m.useRef(e);return he(()=>void(t.current=e),[e]),t}function On({set:e}){return he(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class bt extends m.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}bt.getDerivedStateFromError=()=>({error:!0});const wt="__default",it=new Map,jn=e=>e&&!!e.memoized&&!!e.changes;function xt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Ee(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:o="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e)||D.boo(e))return e===t;const s=D.obj(e);if(s&&o==="reference")return e===t;const v=D.arr(e);if(v&&n==="reference")return e===t;if((v||s)&&e===t)return!0;let g;for(g in e)if(!(g in t))return!1;if(s&&n==="shallow"&&o==="shallow"){for(g in a?t:e)if(!D.equ(e[g],t[g],{strict:a,objects:"reference"}))return!1}else for(g in a?t:e)if(e[g]!==t[g])return!1;if(D.und(g)){if(v&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function An(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function Tn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ie(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function He(e,t){let n=e;if(t.includes("-")){const o=t.split("-"),a=o.pop();return n=o.reduce((s,v)=>s[v],e),{target:n,key:a}}else return{target:n,key:t}}const st=/-\d+$/;function je(e,t,n){if(D.str(n)){if(st.test(n)){const s=n.replace(st,""),{target:v,key:g}=He(e,s);Array.isArray(v[g])||(v[g]=[])}const{target:o,key:a}=He(e,n);t.__r3f.previousAttach=o[a],o[a]=t}else t.__r3f.previousAttach=n(e,t)}function at(e,t,n){var o,a;if(D.str(n)){const{target:s,key:v}=He(e,n),g=t.__r3f.previousAttach;g===void 0?delete s[v]:s[v]=g}else(o=t.__r3f)==null||o.previousAttach==null||o.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function St(e,{children:t,key:n,ref:o,...a},{children:s,key:v,ref:g,...c}={},h=!1){const r=e.__r3f,i=Object.entries(a),p=[];if(h){const f=Object.keys(c);for(let x=0;x<f.length;x++)a.hasOwnProperty(f[x])||i.unshift([f[x],wt+"remove"])}i.forEach(([f,x])=>{var b;if((b=e.__r3f)!=null&&b.primitive&&f==="object"||D.equ(x,c[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return p.push([f,x,!0,[]]);let d=[];f.includes("-")&&(d=f.split("-")),p.push([f,x,!1,d]);for(const u in a){const y=a[u];u.startsWith(`${f}-`)&&p.push([u,y,!1,u.split("-")])}});const l={...a};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(l.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(l.attach=r.memoizedProps.attach),{memoized:l,changes:p}}function Ae(e,t){var n;const o=e.__r3f,a=o==null?void 0:o.root,s=a==null||a.getState==null?void 0:a.getState(),{memoized:v,changes:g}=jn(t)?t:St(e,t),c=o==null?void 0:o.eventCount;e.__r3f&&(e.__r3f.memoizedProps=v);for(let p=0;p<g.length;p++){let[l,f,x,b]=g[p];if(Oe(e)){const M="srgb",E="srgb-linear";l==="encoding"?(l="colorSpace",f=f===3001?M:E):l==="outputEncoding"&&(l="outputColorSpace",f=f===3001?M:E)}let d=e,u=d[l];if(b.length&&(u=b.reduce((y,M)=>y[M],e),!(u&&u.set))){const[y,...M]=b.reverse();d=M.reverse().reduce((E,S)=>E[S],e),l=y}if(f===wt+"remove")if(d.constructor){let y=it.get(d.constructor);y||(y=new d.constructor,it.set(d.constructor,y)),f=y[l]}else f=0;if(x&&o)f?o.handlers[l]=f:delete o.handlers[l],o.eventCount=Object.keys(o.handlers).length;else if(u&&u.set&&(u.copy||u instanceof Ce)){if(Array.isArray(f))u.fromArray?u.fromArray(f):u.set(...f);else if(u.copy&&f&&f.constructor&&u.constructor===f.constructor)u.copy(f);else if(f!==void 0){var h;const y=(h=u)==null?void 0:h.isColor;!y&&u.setScalar?u.setScalar(f):u instanceof Ce&&f instanceof Ce?u.mask=f.mask:u.set(f),!vt()&&s&&!s.linear&&y&&u.convertSRGBToLinear()}}else{var r;if(d[l]=f,(r=d[l])!=null&&r.isTexture&&d[l].format===Jt&&d[l].type===Qt&&s){const y=d[l];Oe(y)&&Oe(s.gl)?y.colorSpace=s.gl.outputColorSpace:y.encoding=s.gl.outputEncoding}}se(e)}if(o&&o.parent&&e.raycast&&c!==o.eventCount){const p=Ee(e).getState().internal,l=p.interaction.indexOf(e);l>-1&&p.interaction.splice(l,1),o.eventCount&&p.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(n=e.__r3f)!=null&&n.parent&&$e(e),e}function se(e){var t,n;const o=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();o&&o.internal.frames===0&&o.invalidate()}function $e(e){e.onUpdate==null||e.onUpdate(e)}function Dn(e,t){e.manual||(gt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Ln(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ae.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ae.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ae.ContinuousEventPriority;default:return ae.DefaultEventPriority}}function Et(e,t,n,o){const a=n.get(t);a&&(n.delete(t),n.size===0&&(e.delete(o),a.target.releasePointerCapture(o)))}function kn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(o=>o!==t),n.initialHits=n.initialHits.filter(o=>o!==t),n.hovered.forEach((o,a)=>{(o.eventObject===t||o.object===t)&&n.hovered.delete(a)}),n.capturedMap.forEach((o,a)=>{Et(n.capturedMap,t,o,a)})}function zn(e){function t(c){const{internal:h}=e.getState(),r=c.offsetX-h.initialClick[0],i=c.offsetY-h.initialClick[1];return Math.round(Math.sqrt(r*r+i*i))}function n(c){return c.filter(h=>["Move","Over","Enter","Out","Leave"].some(r=>{var i;return(i=h.__r3f)==null?void 0:i.handlers["onPointer"+r]}))}function o(c,h){const r=e.getState(),i=new Set,p=[],l=h?h(r.internal.interaction):r.internal.interaction;for(let d=0;d<l.length;d++){const u=fe(l[d]);u&&(u.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(c,r);function f(d){const u=fe(d);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var y;u.events.compute==null||u.events.compute(c,u,(y=u.previousRoot)==null?void 0:y.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(d,!0):[]}let x=l.flatMap(f).sort((d,u)=>{const y=fe(d.object),M=fe(u.object);return!y||!M?d.distance-u.distance:M.events.priority-y.events.priority||d.distance-u.distance}).filter(d=>{const u=we(d);return i.has(u)?!1:(i.add(u),!0)});r.events.filter&&(x=r.events.filter(x,r));for(const d of x){let u=d.object;for(;u;){var b;(b=u.__r3f)!=null&&b.eventCount&&p.push({...d,eventObject:u}),u=u.parent}}if("pointerId"in c&&r.internal.capturedMap.has(c.pointerId))for(let d of r.internal.capturedMap.get(c.pointerId).values())i.has(we(d.intersection))||p.push(d.intersection);return p}function a(c,h,r,i){const p=e.getState();if(c.length){const l={stopped:!1};for(const f of c){const x=fe(f.object)||p,{raycaster:b,pointer:d,camera:u,internal:y}=x,M=new $(d.x,d.y,0).unproject(u),E=j=>{var w,_;return(w=(_=y.capturedMap.get(j))==null?void 0:_.has(f.eventObject))!=null?w:!1},S=j=>{const w={intersection:f,target:h.target};y.capturedMap.has(j)?y.capturedMap.get(j).set(f.eventObject,w):y.capturedMap.set(j,new Map([[f.eventObject,w]])),h.target.setPointerCapture(j)},C=j=>{const w=y.capturedMap.get(j);w&&Et(y.capturedMap,f.eventObject,w,j)};let O={};for(let j in h){let w=h[j];typeof w!="function"&&(O[j]=w)}let P={...f,...O,pointer:d,intersections:c,stopped:l.stopped,delta:r,unprojectedPoint:M,ray:b.ray,camera:u,stopPropagation(){const j="pointerId"in h&&y.capturedMap.get(h.pointerId);if((!j||j.has(f.eventObject))&&(P.stopped=l.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(w=>w.eventObject===f.eventObject))){const w=c.slice(0,c.indexOf(f));s([...w,f])}},target:{hasPointerCapture:E,setPointerCapture:S,releasePointerCapture:C},currentTarget:{hasPointerCapture:E,setPointerCapture:S,releasePointerCapture:C},nativeEvent:h};if(i(P),l.stopped===!0)break}}return c}function s(c){const{internal:h}=e.getState();for(const r of h.hovered.values())if(!c.length||!c.find(i=>i.object===r.object&&i.index===r.index&&i.instanceId===r.instanceId)){const p=r.eventObject.__r3f,l=p==null?void 0:p.handlers;if(h.hovered.delete(we(r)),p!=null&&p.eventCount){const f={...r,intersections:c};l.onPointerOut==null||l.onPointerOut(f),l.onPointerLeave==null||l.onPointerLeave(f)}}}function v(c,h){for(let r=0;r<h.length;r++){const i=h[r].__r3f;i==null||i.handlers.onPointerMissed==null||i.handlers.onPointerMissed(c)}}function g(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return h=>{const{internal:r}=e.getState();"pointerId"in h&&r.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(h.pointerId)&&(r.capturedMap.delete(h.pointerId),s([]))})}}return function(r){const{onPointerMissed:i,internal:p}=e.getState();p.lastEvent.current=r;const l=c==="onPointerMove",f=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",b=o(r,l?n:void 0),d=f?t(r):0;c==="onPointerDown"&&(p.initialClick=[r.offsetX,r.offsetY],p.initialHits=b.map(y=>y.eventObject)),f&&!b.length&&d<=2&&(v(r,p.interaction),i&&i(r)),l&&s(b);function u(y){const M=y.eventObject,E=M.__r3f,S=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(l){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const C=we(y),O=p.hovered.get(C);O?O.stopped&&y.stopPropagation():(p.hovered.set(C,y),S.onPointerOver==null||S.onPointerOver(y),S.onPointerEnter==null||S.onPointerEnter(y))}S.onPointerMove==null||S.onPointerMove(y)}else{const C=S[c];C?(!f||p.initialHits.includes(M))&&(v(r,p.interaction.filter(O=>!p.initialHits.includes(O))),C(y)):f&&p.initialHits.includes(M)&&v(r,p.interaction.filter(O=>!p.initialHits.includes(O)))}}a(b,r,d,u)}}return{handlePointer:g}}const Mt=e=>!!(e!=null&&e.render),Pt=m.createContext(null),Fn=(e,t)=>{const n=Pn((g,c)=>{const h=new $,r=new $,i=new $;function p(d=c().camera,u=r,y=c().size){const{width:M,height:E,top:S,left:C}=y,O=M/E;u.isVector3?i.copy(u):i.set(...u);const P=d.getWorldPosition(h).distanceTo(i);if(gt(d))return{width:M/d.zoom,height:E/d.zoom,top:S,left:C,factor:1,distance:P,aspect:O};{const j=d.fov*Math.PI/180,w=2*Math.tan(j/2)*P,_=w*(M/E);return{width:_,height:w,top:S,left:C,factor:M/_,distance:P,aspect:O}}}let l;const f=d=>g(u=>({performance:{...u.performance,current:d}})),x=new mt;return{set:g,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(d=1)=>e(c(),d),advance:(d,u)=>t(d,u,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Kt,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const d=c();l&&clearTimeout(l),d.performance.current!==d.performance.min&&f(d.performance.min),l=setTimeout(()=>f(c().performance.max),d.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:d=>g(u=>({...u,events:{...u.events,...d}})),setSize:(d,u,y,M,E)=>{const S=c().camera,C={width:d,height:u,top:M||0,left:E||0,updateStyle:y};g(O=>({size:C,viewport:{...O.viewport,...p(S,r,C)}}))},setDpr:d=>g(u=>{const y=xt(d);return{viewport:{...u.viewport,dpr:y,initialDpr:u.viewport.initialDpr||y}}}),setFrameloop:(d="always")=>{const u=c().clock;u.stop(),u.elapsedTime=0,d!=="never"&&(u.start(),u.elapsedTime=0),g(()=>({frameloop:d}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(d,u,y)=>{const M=c().internal;return M.priority=M.priority+(u>0?1:0),M.subscribers.push({ref:d,priority:u,store:y}),M.subscribers=M.subscribers.sort((E,S)=>E.priority-S.priority),()=>{const E=c().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(u>0?1:0),E.subscribers=E.subscribers.filter(S=>S.ref!==d))}}}}}),o=n.getState();let a=o.size,s=o.viewport.dpr,v=o.camera;return n.subscribe(()=>{const{camera:g,size:c,viewport:h,gl:r,set:i}=n.getState();if(c.width!==a.width||c.height!==a.height||h.dpr!==s){var p;a=c,s=h.dpr,Dn(g,c),r.setPixelRatio(h.dpr);const l=(p=c.updateStyle)!=null?p:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(c.width,c.height,l)}g!==v&&(v=g,i(l=>({viewport:{...l.viewport,...l.viewport.getCurrentViewport(g)}})))}),n.subscribe(g=>e(g)),n};let xe,In=new Set,Wn=new Set,Hn=new Set;function Te(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function de(e,t){switch(e){case"before":return Te(In,t);case"after":return Te(Wn,t);case"tail":return Te(Hn,t)}}let De,Le;function ke(e,t,n){let o=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(o=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),De=t.internal.subscribers,xe=0;xe<De.length;xe++)Le=De[xe],Le.ref.current(Le.store.getState(),o,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function $n(e){let t=!1,n=!1,o,a,s;function v(h){a=requestAnimationFrame(v),t=!0,o=0,de("before",h),n=!0;for(const i of e.values()){var r;s=i.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((r=s.gl.xr)!=null&&r.isPresenting)&&(o+=ke(h,s))}if(n=!1,de("after",h),o===0)return de("tail",h),t=!1,cancelAnimationFrame(a)}function g(h,r=1){var i;if(!h)return e.forEach(p=>g(p.store.getState(),r));(i=h.gl.xr)!=null&&i.isPresenting||!h.internal.active||h.frameloop==="never"||(r>1?h.internal.frames=Math.min(60,h.internal.frames+r):n?h.internal.frames=2:h.internal.frames=1,t||(t=!0,requestAnimationFrame(v)))}function c(h,r=!0,i,p){if(r&&de("before",h),i)ke(h,i,p);else for(const l of e.values())ke(h,l.store.getState());r&&de("after",h)}return{loop:v,invalidate:g,advance:c}}function _t(){const e=m.useContext(Pt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function N(e=n=>n,t){return _t()(e,t)}function ve(e,t=0){const n=_t(),o=n.getState().internal.subscribe,a=yt(e);return he(()=>o(a,t,n),[t,o,n]),null}const ct=new WeakMap;function Ct(e,t){return function(n,...o){let a=ct.get(n);return a||(a=new n,ct.set(n,a)),e&&e(a),Promise.all(o.map(s=>new Promise((v,g)=>a.load(s,c=>{c.scene&&Object.assign(c,An(c.scene)),v(c)},t,c=>g(new Error(`Could not load ${s}: ${c==null?void 0:c.message}`))))))}}function J(e,t,n,o){const a=Array.isArray(t)?t:[t],s=wn(Ct(n,o),[e,...a],{equal:D.equ});return Array.isArray(t)?s:s[0]}J.preload=function(e,t,n){const o=Array.isArray(t)?t:[t];return xn(Ct(n),[e,...o])};J.clear=function(e,t){const n=Array.isArray(t)?t:[t];return Sn([e,...n])};const le=new Map,{invalidate:lt,advance:ut}=$n(le),{reconciler:Me,applyProps:V}=Cn(le,Ln),oe={objects:"shallow",strict:!1},Bn=(e,t)=>{const n=typeof e=="function"?e(t):e;return Mt(n)?n:new Yt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Nn(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:o,height:a,top:s,left:v,updateStyle:g=n}=t;return{width:o,height:a,top:s,left:v,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:a,top:s,left:v}=e.parentElement.getBoundingClientRect();return{width:o,height:a,top:s,left:v,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Un(e){const t=le.get(e),n=t==null?void 0:t.fiber,o=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,s=o||Fn(lt,ut),v=n||Me.createContainer(s,ae.ConcurrentRoot,null,!1,null,"",a,null);t||le.set(e,{fiber:v,store:s});let g,c=!1,h;return{configure(r={}){let{gl:i,size:p,scene:l,events:f,onCreated:x,shadows:b=!1,linear:d=!1,flat:u=!1,legacy:y=!1,orthographic:M=!1,frameloop:E="always",dpr:S=[1,2],performance:C,raycaster:O,camera:P,onPointerMissed:j}=r,w=s.getState(),_=w.gl;w.gl||w.set({gl:_=Bn(i,e)});let W=w.raycaster;W||w.set({raycaster:W=new Bt});const{params:q,...k}=O||{};if(D.equ(k,W,oe)||V(W,{...k}),D.equ(q,W.params,oe)||V(W,{params:{...W.params,...q}}),!w.camera||w.camera===h&&!D.equ(h,P,oe)){h=P;const A=P instanceof Zt,T=A?P:M?new Ne(0,0,0,0,.1,1e3):new Ue(75,0,.1,1e3);A||(T.position.z=5,P&&(V(T,P),("aspect"in P||"left"in P||"right"in P||"bottom"in P||"top"in P)&&(T.manual=!0,T.updateProjectionMatrix())),!w.camera&&!(P!=null&&P.rotation)&&T.lookAt(0,0,0)),w.set({camera:T}),W.camera=T}if(!w.scene){let A;l!=null&&l.isScene?A=l:(A=new Nt,l&&V(A,l)),w.set({scene:ie(A)})}if(!w.xr){var U;const A=(R,Z)=>{const X=s.getState();X.frameloop!=="never"&&ut(R,!0,X,Z)},T=()=>{const R=s.getState();R.gl.xr.enabled=R.gl.xr.isPresenting,R.gl.xr.setAnimationLoop(R.gl.xr.isPresenting?A:null),R.gl.xr.isPresenting||lt(R)},H={connect(){const R=s.getState().gl;R.xr.addEventListener("sessionstart",T),R.xr.addEventListener("sessionend",T)},disconnect(){const R=s.getState().gl;R.xr.removeEventListener("sessionstart",T),R.xr.removeEventListener("sessionend",T)}};typeof((U=_.xr)==null?void 0:U.addEventListener)=="function"&&H.connect(),w.set({xr:H})}if(_.shadowMap){const A=_.shadowMap.enabled,T=_.shadowMap.type;if(_.shadowMap.enabled=!!b,D.boo(b))_.shadowMap.type=_e;else if(D.str(b)){var z;const H={basic:Vt,percentage:Gt,soft:_e,variance:Ut};_.shadowMap.type=(z=H[b])!=null?z:_e}else D.obj(b)&&Object.assign(_.shadowMap,b);(A!==_.shadowMap.enabled||T!==_.shadowMap.type)&&(_.shadowMap.needsUpdate=!0)}const F=vt();F&&("enabled"in F?F.enabled=!y:"legacyMode"in F&&(F.legacyMode=y)),c||V(_,{outputEncoding:d?3e3:3001,toneMapping:u?qt:Xt}),w.legacy!==y&&w.set(()=>({legacy:y})),w.linear!==d&&w.set(()=>({linear:d})),w.flat!==u&&w.set(()=>({flat:u})),i&&!D.fun(i)&&!Mt(i)&&!D.equ(i,_,oe)&&V(_,i),f&&!w.events.handlers&&w.set({events:f(s)});const I=Nn(e,p);return D.equ(I,w.size,oe)||w.setSize(I.width,I.height,I.updateStyle,I.top,I.left),S&&w.viewport.dpr!==xt(S)&&w.setDpr(S),w.frameloop!==E&&w.setFrameloop(E),w.onPointerMissed||w.set({onPointerMissed:j}),C&&!D.equ(C,w.performance,oe)&&w.set(A=>({performance:{...A.performance,...C}})),g=x,c=!0,this},render(r){return c||this.configure(),Me.updateContainer(G.jsx(Gn,{store:s,children:r,onCreated:g,rootElement:e}),v,null,()=>{}),s},unmount(){Rt(e)}}}function Gn({store:e,children:t,onCreated:n,rootElement:o}){return he(()=>{const a=e.getState();a.set(s=>({internal:{...s.internal,active:!0}})),n&&n(a),e.getState().events.connected||a.events.connect==null||a.events.connect(o)},[]),G.jsx(Pt.Provider,{value:e,children:t})}function Rt(e,t){const n=le.get(e),o=n==null?void 0:n.fiber;if(o){const a=n==null?void 0:n.store.getState();a&&(a.internal.active=!1),Me.updateContainer(null,o,null,()=>{a&&setTimeout(()=>{try{var s,v,g,c;a.events.disconnect==null||a.events.disconnect(),(s=a.gl)==null||(v=s.renderLists)==null||v.dispose==null||v.dispose(),(g=a.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(c=a.gl)!=null&&c.xr&&a.xr.disconnect(),Tn(a),le.delete(e)}catch{}},500)})}}Me.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:m.version});const ze={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Vn(e){const{handlePointer:t}=zn(e);return{priority:1,enabled:!0,compute(n,o,a){o.pointer.set(n.offsetX/o.size.width*2-1,-(n.offsetY/o.size.height)*2+1),o.raycaster.setFromCamera(o.pointer,o.camera)},connected:void 0,handlers:Object.keys(ze).reduce((n,o)=>({...n,[o]:t(o)}),{}),update:()=>{var n;const{events:o,internal:a}=e.getState();(n=a.lastEvent)!=null&&n.current&&o.handlers&&o.handlers.onPointerMove(a.lastEvent.current)},connect:n=>{var o;const{set:a,events:s}=e.getState();s.disconnect==null||s.disconnect(),a(v=>({events:{...v.events,connected:n}})),Object.entries((o=s.handlers)!=null?o:[]).forEach(([v,g])=>{const[c,h]=ze[v];n.addEventListener(c,g,{passive:h})})},disconnect:()=>{const{set:n,events:o}=e.getState();if(o.connected){var a;Object.entries((a=o.handlers)!=null?a:[]).forEach(([s,v])=>{if(o&&o.connected instanceof HTMLElement){const[g]=ze[s];o.connected.removeEventListener(g,v)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}const qn=m.forwardRef(function({children:t,fallback:n,resize:o,style:a,gl:s,events:v=Vn,eventSource:g,eventPrefix:c,shadows:h,linear:r,flat:i,legacy:p,orthographic:l,frameloop:f,dpr:x,performance:b,raycaster:d,camera:u,scene:y,onPointerMissed:M,onCreated:E,...S},C){m.useMemo(()=>_n(en),[]);const O=pn(),[P,j]=fn({scroll:!0,debounce:{scroll:50,resize:0},...o}),w=m.useRef(null),_=m.useRef(null);m.useImperativeHandle(C,()=>w.current);const W=yt(M),[q,k]=m.useState(!1),[U,z]=m.useState(!1);if(q)throw q;if(U)throw U;const F=m.useRef(null);he(()=>{const A=w.current;j.width>0&&j.height>0&&A&&(F.current||(F.current=Un(A)),F.current.configure({gl:s,events:v,shadows:h,linear:r,flat:i,legacy:p,orthographic:l,frameloop:f,dpr:x,performance:b,raycaster:d,camera:u,scene:y,size:j,onPointerMissed:(...T)=>W.current==null?void 0:W.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(g?Rn(g)?g.current:g:_.current),c&&T.setEvents({compute:(H,R)=>{const Z=H[c+"X"],X=H[c+"Y"];R.pointer.set(Z/R.size.width*2-1,-(X/R.size.height)*2+1),R.raycaster.setFromCamera(R.pointer,R.camera)}}),E==null||E(T)}}),F.current.render(G.jsx(O,{children:G.jsx(bt,{set:z,children:G.jsx(m.Suspense,{fallback:G.jsx(On,{set:k}),children:t})})})))}),m.useEffect(()=>{const A=w.current;if(A)return()=>Rt(A)},[]);const I=g?"none":"auto";return G.jsx("div",{ref:_,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:I,...a},...S,children:G.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:w,style:{display:"block"},children:n})})})}),xr=m.forwardRef(function(t,n){return G.jsx(dn,{children:G.jsx(qn,{...t,ref:n})})}),ge=new $,Xe=new $,Xn=new $,ft=new mt;function Yn(e,t,n){const o=ge.setFromMatrixPosition(e.matrixWorld);o.project(t);const a=n.width/2,s=n.height/2;return[o.x*a+a,-(o.y*s)+s]}function Zn(e,t){const n=ge.setFromMatrixPosition(e.matrixWorld),o=Xe.setFromMatrixPosition(t.matrixWorld),a=n.sub(o),s=t.getWorldDirection(Xn);return a.angleTo(s)>Math.PI/2}function Kn(e,t,n,o){const a=ge.setFromMatrixPosition(e.matrixWorld),s=a.clone();s.project(t),ft.set(s.x,s.y),n.setFromCamera(ft,t);const v=n.intersectObjects(o,!0);if(v.length){const g=v[0].distance;return a.distanceTo(n.ray.origin)<g}return!0}function Jn(e,t){if(t instanceof Ne)return t.zoom;if(t instanceof Ue){const n=ge.setFromMatrixPosition(e.matrixWorld),o=Xe.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,s=n.distanceTo(o);return 1/(2*Math.tan(a/2)*s)}else return 1}function Qn(e,t,n){if(t instanceof Ue||t instanceof Ne){const o=ge.setFromMatrixPosition(e.matrixWorld),a=Xe.setFromMatrixPosition(t.matrixWorld),s=o.distanceTo(a),v=(n[1]-n[0])/(t.far-t.near),g=n[1]-v*t.far;return Math.round(v*s+g)}}const Be=e=>Math.abs(e)<1e-10?0:e;function Ot(e,t,n=""){let o="matrix3d(";for(let a=0;a!==16;a++)o+=Be(t[a]*e.elements[a])+(a!==15?",":")");return n+o}const er=(e=>t=>Ot(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),tr=(e=>(t,n)=>Ot(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function nr(e){return e&&typeof e=="object"&&"current"in e}const Sr=m.forwardRef(({children:e,eps:t=.001,style:n,className:o,prepend:a,center:s,fullscreen:v,portal:g,distanceFactor:c,sprite:h=!1,transform:r=!1,occlude:i,onOcclude:p,castShadow:l,receiveShadow:f,material:x,geometry:b,zIndexRange:d=[16777271,0],calculatePosition:u=Yn,as:y="div",wrapperClass:M,pointerEvents:E="auto",...S},C)=>{const{gl:O,camera:P,scene:j,size:w,raycaster:_,events:W,viewport:q}=N(),[k]=m.useState(()=>document.createElement(y)),U=m.useRef(),z=m.useRef(null),F=m.useRef(0),I=m.useRef([0,0]),A=m.useRef(null),T=m.useRef(null),H=(g==null?void 0:g.current)||W.connected||O.domElement.parentNode,R=m.useRef(null),Z=m.useRef(!1),X=m.useMemo(()=>i&&i!=="blending"||Array.isArray(i)&&i.length&&nr(i[0]),[i]);m.useLayoutEffect(()=>{const B=O.domElement;i&&i==="blending"?(B.style.zIndex=`${Math.floor(d[0]/2)}`,B.style.position="absolute",B.style.pointerEvents="none"):(B.style.zIndex=null,B.style.position=null,B.style.pointerEvents=null)},[i]),m.useLayoutEffect(()=>{if(z.current){const B=U.current=hn(k);if(j.updateMatrixWorld(),r)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const L=u(z.current,P,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${L[0]}px,${L[1]}px,0);transform-origin:0 0;`}return H&&(a?H.prepend(k):H.appendChild(k)),()=>{H&&H.removeChild(k),B.unmount()}}},[H,r]),m.useLayoutEffect(()=>{M&&(k.className=M)},[M]);const Ze=m.useMemo(()=>r?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...v&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...n},[n,s,v,w,r]),Lt=m.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);m.useLayoutEffect(()=>{if(Z.current=!1,r){var B;(B=U.current)==null||B.render(m.createElement("div",{ref:A,style:Ze},m.createElement("div",{ref:T,style:Lt},m.createElement("div",{ref:C,className:o,style:n,children:e}))))}else{var L;(L=U.current)==null||L.render(m.createElement("div",{ref:C,style:Ze,className:o,children:e}))}});const re=m.useRef(!0);ve(B=>{if(z.current){P.updateMatrixWorld(),z.current.updateWorldMatrix(!0,!1);const L=r?I.current:u(z.current,P,w);if(r||Math.abs(F.current-P.zoom)>t||Math.abs(I.current[0]-L[0])>t||Math.abs(I.current[1]-L[1])>t){const Q=Zn(z.current,P);let Y=!1;X&&(Array.isArray(i)?Y=i.map(ee=>ee.current):i!=="blending"&&(Y=[j]));const ue=re.current;if(Y){const ee=Kn(z.current,P,_,Y);re.current=ee&&!Q}else re.current=!Q;ue!==re.current&&(p?p(!re.current):k.style.display=re.current?"block":"none");const ye=Math.floor(d[0]/2),kt=i?X?[d[0],ye]:[ye-1,0]:d;if(k.style.zIndex=`${Qn(z.current,P,kt)}`,r){const[ee,Je]=[w.width/2,w.height/2],Pe=P.projectionMatrix.elements[5]*Je,{isOrthographicCamera:Qe,top:zt,left:Ft,bottom:It,right:Wt}=P,Ht=er(P.matrixWorldInverse),$t=Qe?`scale(${Pe})translate(${Be(-(Wt+Ft)/2)}px,${Be((zt+It)/2)}px)`:`translateZ(${Pe}px)`;let te=z.current.matrixWorld;h&&(te=P.matrixWorldInverse.clone().transpose().copyPosition(te).scale(z.current.scale),te.elements[3]=te.elements[7]=te.elements[11]=0,te.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Qe?"":`${Pe}px`,A.current&&T.current&&(A.current.style.transform=`${$t}${Ht}translate(${ee}px,${Je}px)`,T.current.style.transform=tr(te,1/((c||10)/400)))}else{const ee=c===void 0?1:Jn(z.current,P)*c;k.style.transform=`translate3d(${L[0]}px,${L[1]}px,0) scale(${ee})`}I.current=L,F.current=P.zoom}}if(!X&&R.current&&!Z.current)if(r){if(A.current){const L=A.current.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const{isOrthographicCamera:Q}=P;if(Q||b)S.scale&&(Array.isArray(S.scale)?S.scale instanceof $?R.current.scale.copy(S.scale.clone().divideScalar(1)):R.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):R.current.scale.setScalar(1/S.scale));else{const Y=(c||10)/400,ue=L.clientWidth*Y,ye=L.clientHeight*Y;R.current.scale.set(ue,ye,1)}Z.current=!0}}}else{const L=k.children[0];if(L!=null&&L.clientWidth&&L!=null&&L.clientHeight){const Q=1/q.factor,Y=L.clientWidth*Q,ue=L.clientHeight*Q;R.current.scale.set(Y,ue,1),Z.current=!0}R.current.lookAt(B.camera.position)}});const Ke=m.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return m.createElement("group",K({},S,{ref:z}),i&&!X&&m.createElement("mesh",{castShadow:l,receiveShadow:f,ref:R},b||m.createElement("planeGeometry",null),x||m.createElement("shaderMaterial",{side:tn,vertexShader:Ke.vertexShader,fragmentShader:Ke.fragmentShader})))});let pe=0;const Er=vn(e=>(be.onStart=(t,n,o)=>{e({active:!0,item:t,loaded:n,total:o,progress:(n-pe)/(o-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(n=>({errors:[...n.errors,t]})),be.onProgress=(t,n,o)=>{n===o&&(pe=o),e({active:!0,item:t,loaded:n,total:o,progress:(n-pe)/(o-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Fe=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function jt(e,t){const n=N(s=>s.gl),o=J(Ge,Fe(e)?Object.values(e):e);return m.useLayoutEffect(()=>{t==null||t(o)},[t]),m.useEffect(()=>{if("initTexture"in n){let s=[];Array.isArray(o)?s=o:o instanceof et?s=[o]:Fe(o)&&(s=Object.values(o)),s.forEach(v=>{v instanceof et&&n.initTexture(v)})}},[n,o]),m.useMemo(()=>{if(Fe(e)){const s={};let v=0;for(const g in e)s[g]=o[v++];return s}else return o},[e,o])}jt.preload=e=>J.preload(Ge,e);jt.clear=e=>J.clear(Ge,e);const rr=()=>parseInt(nn.replace(/\D+/g,"")),At=rr();function or(e){return Array.isArray(e)}function Ie(e=[0,0,0]){return or(e)?e:e instanceof $||e instanceof ht?[e.x,e.y,e.z]:[e,e,e]}const Mr=m.forwardRef(function({debug:t,depthTest:n=!1,polygonOffsetFactor:o=-10,map:a,mesh:s,children:v,position:g,rotation:c,scale:h,...r},i){const p=m.useRef(null);m.useImperativeHandle(i,()=>p.current);const l=m.useRef(null),f=m.useRef({position:new $,rotation:new ht,scale:new $(1,1,1)});return m.useLayoutEffect(()=>{const x=(s==null?void 0:s.current)||p.current.parent,b=p.current;if(!(x instanceof rn))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(x){V(f.current,{position:g,scale:h});const d=x.matrixWorld.clone();if(x.matrixWorld.identity(),!c||typeof c=="number"){const u=new on;u.position.copy(f.current.position);const y=x.geometry.attributes.position.array;x.geometry.attributes.normal===void 0&&x.geometry.computeVertexNormals();const M=x.geometry.attributes.normal.array;let E=1/0;new $;let S=new $;const C=u.position.x,O=u.position.y,P=u.position.z,j=y.length;let w=-1;for(let _=0;_<j;_+=3){const W=y[_],q=y[_+1],k=y[_+2],U=W-C,z=q-O,F=k-P,I=U*U+z*z+F*F;I<E&&(E=I,w=_)}S.fromArray(M,w),u.lookAt(u.position.clone().add(S)),u.rotateZ(Math.PI),u.rotateY(Math.PI),typeof c=="number"&&u.rotateZ(c),V(f.current,{rotation:u.rotation})}else V(f.current,{rotation:c});return b.geometry=new gn(x,f.current.position,f.current.rotation,f.current.scale),x.matrixWorld=d,()=>{b.geometry.dispose()}}},[s,...Ie(g),...Ie(h),...Ie(c)]),m.useLayoutEffect(()=>{l.current&&(V(l.current,f.current),l.current.traverse(x=>x.raycast=()=>null))},[t]),m.createElement("mesh",K({ref:p,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":o,"material-depthTest":n,"material-map":a},r),v,t&&m.createElement("mesh",{ref:l},m.createElement("boxGeometry",null),m.createElement("meshNormalMaterial",{wireframe:!0}),m.createElement("axesHelper",null)))});let Se=null,Tt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Dt(e=!0,t=!0,n){return o=>{n&&n(o),e&&(Se||(Se=new yn),Se.setDecoderPath(typeof e=="string"?e:Tt),o.setDRACOLoader(Se)),t&&o.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}const Ye=(e,t,n,o)=>J(Ve,e,Dt(t,n,o));Ye.preload=(e,t,n,o)=>J.preload(Ve,e,Dt(t,n,o));Ye.clear=e=>J.clear(Ve,e);Ye.setDecoderPath=e=>{Tt=e};const Pr=m.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:o,enableDamping:a=!0,keyEvents:s=!1,onChange:v,onStart:g,onEnd:c,...h},r)=>{const i=N(S=>S.invalidate),p=N(S=>S.camera),l=N(S=>S.gl),f=N(S=>S.events),x=N(S=>S.setEvents),b=N(S=>S.set),d=N(S=>S.get),u=N(S=>S.performance),y=t||p,M=o||f.connected||l.domElement,E=m.useMemo(()=>new bn(y),[y]);return ve(()=>{E.enabled&&E.update()},-1),m.useEffect(()=>(s&&E.connect(s===!0?M:s),E.connect(M),()=>void E.dispose()),[s,M,n,E,i]),m.useEffect(()=>{const S=P=>{i(),n&&u.regress(),v&&v(P)},C=P=>{g&&g(P)},O=P=>{c&&c(P)};return E.addEventListener("change",S),E.addEventListener("start",C),E.addEventListener("end",O),()=>{E.removeEventListener("start",C),E.removeEventListener("end",O),E.removeEventListener("change",S)}},[v,g,c,E,i,x]),m.useEffect(()=>{if(e){const S=d().controls;return b({controls:E}),()=>b({controls:S})}},[e,E]),m.createElement("primitive",K({ref:r,object:E,enableDamping:a},h))}),We=At>=154?"opaque_fragment":"output_fragment";class ir extends sn{constructor(t){super(t),this.onBeforeCompile=(n,o)=>{const{isWebGL2:a}=o.capabilities;n.fragmentShader=n.fragmentShader.replace(`#include <${We}>`,`
        ${a?`#include <${We}>`:`#extension GL_OES_standard_derivatives : enable
#include <${We}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${At>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const _r=m.forwardRef((e,t)=>{const[n]=m.useState(()=>new ir(null));return m.createElement("primitive",K({},e,{object:n,ref:t,attach:"material"}))}),Cr=m.forwardRef(({children:e,enabled:t=!0,speed:n=1,rotationIntensity:o=1,floatIntensity:a=1,floatingRange:s=[-.1,.1],autoInvalidate:v=!1,...g},c)=>{const h=m.useRef(null);m.useImperativeHandle(c,()=>h.current,[]);const r=m.useRef(Math.random()*1e4);return ve(i=>{var p,l;if(!t||n===0)return;v&&i.invalidate();const f=r.current+i.clock.getElapsedTime();h.current.rotation.x=Math.cos(f/4*n)/8*o,h.current.rotation.y=Math.sin(f/4*n)/8*o,h.current.rotation.z=Math.sin(f/4*n)/20*o;let x=Math.sin(f/4*n)/10;x=an.mapLinear(x,-.1,.1,(p=s==null?void 0:s[0])!==null&&p!==void 0?p:-.1,(l=s==null?void 0:s[1])!==null&&l!==void 0?l:.1),h.current.position.y=x*a,h.current.updateMatrix()}),m.createElement("group",g,m.createElement("group",{ref:h,matrixAutoUpdate:!1},e))});let ne,me;const sr=m.createContext(null),dt=new cn,pt=new $,ar=m.forwardRef(({children:e,range:t,limit:n=1e3,...o},a)=>{const s=m.useRef(null);m.useImperativeHandle(a,()=>s.current,[]);const[v,g]=m.useState([]),[[c,h,r]]=m.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);m.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),ve(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),dt.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(n,t!==void 0?t:n,v.length),ne=0;ne<v.length;ne++)me=v[ne].current,me.getWorldPosition(pt).applyMatrix4(dt),pt.toArray(c,ne*3),s.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(h,ne*3),s.current.geometry.attributes.color.needsUpdate=!0,r.set([me.size],ne),s.current.geometry.attributes.size.needsUpdate=!0});const i=m.useMemo(()=>({getParent:()=>s,subscribe:p=>(g(l=>[...l,p]),()=>g(l=>l.filter(f=>f.current!==p.current)))}),[]);return m.createElement("points",K({userData:{instances:v},matrixAutoUpdate:!1,ref:s,raycast:()=>null},o),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:ce}),m.createElement("bufferAttribute",{attach:"attributes-color",count:h.length/3,array:h,itemSize:3,usage:ce}),m.createElement("bufferAttribute",{attach:"attributes-size",count:r.length,array:r,itemSize:1,usage:ce})),m.createElement(sr.Provider,{value:i},e))}),cr=m.forwardRef(({children:e,positions:t,colors:n,sizes:o,stride:a=3,...s},v)=>{const g=m.useRef(null);return m.useImperativeHandle(v,()=>g.current,[]),ve(()=>{const c=g.current.geometry.attributes;c.position.needsUpdate=!0,n&&(c.color.needsUpdate=!0),o&&(c.size.needsUpdate=!0)}),m.createElement("points",K({ref:g},s),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:ce}),n&&m.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/a,array:n,itemSize:3,usage:ce}),o&&m.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/a,array:o,itemSize:1,usage:ce})),e)}),Rr=m.forwardRef((e,t)=>e.positions instanceof Float32Array?m.createElement(cr,K({},e,{ref:t})):m.createElement(ar,K({},e,{ref:t})));function Or({all:e,scene:t,camera:n}){const o=N(({gl:v})=>v),a=N(({camera:v})=>v),s=N(({scene:v})=>v);return m.useLayoutEffect(()=>{const v=[];e&&(t||s).traverse(h=>{h.visible===!1&&(v.push(h),h.visible=!0)}),o.compile(t||s,n||a);const g=new ln(128);new un(.01,1e5,g).update(o,t||s),g.dispose(),v.forEach(h=>h.visible=!1)},[]),null}export{xr as C,Mr as D,Cr as F,Sr as H,Pr as O,Or as P,jt as a,ve as b,Rr as c,_r as d,Ye as e,Er as u};
